## Windows Logging in SIEM Enviroments - TryHackMe Room ##
Things Covered:
- Finding and interpreting important windows event logs
- cover log sources: Sysmon, Powershell, and Windows Events
- practicing log analysis skills in multiple event log databases

https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4624

### What is Logged in a Windows Machine ###
The purpose of logging is to serve MANY purpose, like ...
* _Incident Response_: when and how an attack occurred
* _Threat Hunting_: search for malicious IOC's
* _Alerting and Triage_: help building new alerts or detection rules

in windows, this logs are stored as .EVTX files --> fall into specific log catagories (Application, Security, Setup...)<br>

### Security Log: Authentication ###
Important Log Recap! <br>

Event 4624 - Successful Logon: <br>
- Can be used to detect suspicious logings from RDP/network and identify the attack starting point (timestamping). however it is also one of the most noisy logs events generated.

Event 4625 - Failed Logon: <br>
- Can be used to detect brute force, password spraying, or vulnerability scanning. however it can be very inconsistent with how this logs are generated. 

__Detecting RDP Brute Forcing:__
1. filter for event id 4625 for failed logons
2. search for events wuth logon type 3 or 10
    - modern system == 3, old/misconfigured == 10
3. red flags to look for include attempted user logons at common privilleged accounts like admin, adminstrator, helpdesk ... additionally, workstation name and IP address can be used to signal norm from abnormal. 

__Analyzing RDP Logons:__
1. filter for 4624 in Security logs
2. look again for logon type 3/10
3. if a logon IS malicious, save/take a note of the Logon ID that is generated, this is a unique generated by Windows for session identification!

__Q: Which IP performed a brute force attack on the THM-PC?__
- 10.10.53.248
__Q: Which user was breached as a result of that attack?__
- Administrator (makes sense, default adminstrator account on Windows)
__Q: What was the Logon ID of the malicious RDP login?__
- 0x183C36D

### Security Log: User Management ###
Being able to activity track what users and service accounts exist on a machine is VERY important (IAM!) <br>

Important Windows User Management Events:
- (4720/4722/4738) | User Account was created/enabled/changed | Used to create backdoor accounts, enable old accs to aviod detection.
- (4725/4726) | User Account was disabled/deleted | can be used to disable adminstrator accounts to slow down defenders, and also erase presence on a machine for anti-forensics.

Basic Structure of any User Management Event...:
1. Subject: account doing the action
2. Object: target of the action being done
3. Details: explaination of the action being done

__Hunting for Backdoor Users:__
1. open security logs --> search for events 4720 + 4732
2. Red Flags include
- no one can confirm the actions being done
- changes to user accounts where made outside of working hours
- subject username is unknown/unexpected
- target username does not follow usual organization naming conventions
3. If confirmed malicious:
- copy logon ID field for future referencing
- track down potential activity from modified user accounts

### Sysmon: Process Monitoring ###
In windows, you have two ways to learn a lot more about process on a machine:
- In Security logs, enable logging for event 4688, which is VERY noisy
- Configuration Sysmon to give advanced logging in comparison to the default (we all LOVE sysmon)

For Reference, look at notes created in TryHackRoom done for Sysmon/Process Monitor! <br>

### Sysmon: Files and Network ###
Sysmon can provide a lot more information then just process creation!! it can log file and registry changes, netowkr connection, DNS queries, and other crucial events in which regular Windows Logs can be lacking in. <br>

### PowerShell: Logging Commands and Activity ###
tracking powershell activity can be harder due to the fact that a lot can be done in one process shell in short period of time, and the contents of the shell activity can be hard to find ... <br>

quick check number 1:<br>
- Powershelll History File: `C:\Users\<USER>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt` <br>

good room! :D